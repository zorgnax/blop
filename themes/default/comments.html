<br/>

<h3>[% entry.num_comments %] Comment[% IF entry.num_comments != 1 %]s[% END %]</h3>

[% FOREACH comment IN entry.comments %]
<div class="comment[% IF comment.editable %] editable-comment[% END %]" data-commentid="[% comment.commentid %]">
<div class="comment-heading">
<b>[% comment.name | html %]</b> on [% comment.added | html %]
[% IF comment.status != "approved" %] <span class="awaiting-moderation">Awaiting moderation</span>[% END %]
[% IF comment.editable %]
<a href="#" class="edit-comment">edit</a>
<a href="#" class="delete-comment">delete</a>
[% END %]
</div>
<div class="comment-content">
[% comment.parsed_content %]
</div>
[% IF comment.editable %]
<div class="edit-comment-form" style="display:none">

<form method="post" class="pform">
<input type="hidden" name="[% entryid %]" value="[% entry.$entryid %]"/>
<input type="hidden" name="commentid" value="[% comment.commentid %]"/>

<table><tr><td><label for="name-[% comment.commentid %]">Name:</label></td>
<td><input id="name-[% comment.commentid %]" name="name" type="text" value="[% comment.name | html %]"/><span class="name-error pform-error"></span></td></tr>

<tr><td><label for="email-[% comment.commentid %]">Email:</label></td>
<td><input id="email-[% comment.commentid %]" name="email" type="text" value="[% comment.email %]"/><span class="email-error pform-error"></span></td></tr>

<tr><td><label for="content-[% comment.commentid %]">Comment:</label></td>
<td><textarea id="content-[% comment.commentid %]" name="content">[% comment.content | html %]</textarea></span></td></tr>

<tr><td></td>
<td><input type="submit" value="Post Comment"/><span class="pform-mesg pform-error"></span></td></tr></table>

</form>

[% IF comment.edited %]Last edited: [% comment.edited %][% END %]

</div>
[% END %]
</div>
<br/>
[% END %]

<form id="comment" method="post" class="pform">
<input type="hidden" name="[% entryid %]" value="[% entry.$entryid %]"/>
<input type="hidden" name="bake" value="1"/>

<table><tr><td><label for="name">Name:</label></td>
<td><input id="name" name="name" type="text" value=""/><span class="name-error pform-error"></span></td></tr>

<tr><td><label for="email">Email:</label></td>
<td><input id="email" name="email" type="text" value=""/><span class="email-error pform-error"></span></td></tr>

<tr><td><label for="content">Comment:</label></td>
<td><textarea id="content" name="content"></textarea></span></td></tr>

<tr><td></td>
<td><input type="submit" value="Post Comment"/><span class="pform-mesg pform-error"></span></td></tr></table>

</form>

<script type="text/javascript" src="[% url('comments.js') %]"></script>
<script type="text/javascript">
var comments = new Comments({
    formId: "#comment",
    editableComments: ".editable-comment",
    processUrl: "[% urlbase %]/admin/comment-js",
    deleteUrl: "[% urlbase %]/admin/delete-comment-js"});
</script>

